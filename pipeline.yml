version: '1.0'
stages:
 - build
 - test
 - deploy
steps:

  BuildingDockerImage:
    title: Building Docker Image
    type: build
    stage: 'build'
    image_name: jumpst3r/printed-hw-segmentation
    working_directory: ./docker/
    tag: 'latest'
    dockerfile: Dockerfile

  TestRunnable:
    title: Running Tests
    stage: 'test'
    image: r.cfcr.io/jumpst3r/jumpst3r/printed-hw-segmentation:latest
    commands:
      - apt update && apt install python-pip python-setuptools python-dev build-essential --no-install-recommends -y
      - pip install wheel
      - pip install numpy scikit-image pytest
      - cd /input/
      - py.test

  PushingToDockerRegistry:
    type: push
    stage: 'deploy'
    title: Pushing To Dockerhub Registry
    candidate: r.cfcr.io/jumpst3r/jumpst3r/printed-hw-segmentation:latest
    tag: 'latest'
    image_name: jumpst3r/printed-hw-segmentation
    registry: dockerhub